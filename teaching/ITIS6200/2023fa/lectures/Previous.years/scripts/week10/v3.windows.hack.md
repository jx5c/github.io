hello and welcome to episode 2 of tradecraft security weekly this week I'm going to discuss some Windows privilege escalation techniques one of my favorite topics specifically I'm only going to be talking about local purple Jessica lotion technique so later on on another episode I'm going to discuss a network-based privilege escalation techniques as well and then we'll also do one that focuses on Linux as well but this one specifically Windows so let's just jump right in so admin access Admin Access should be rare and pretty much every scenario that I can think of standard employees shouldn't have administrative access to their systems you know one common thing that I've seen is where a remote like worker let's say like you have like somebody an organization that goes like off site from from the standard office you know they're out for the day a lot of times they carry laptop with them and a lot of times network admins decide to give them an intuitive access to their own system for the sake of troubleshooting and you know a lot of times we'll see like you know we'll get handed of laptop for an assessment and we already have admin access and you know that's just it's not a good thing so you know one thing that I wanted to mention the two is network admins not only have to worry about provisioning the access correctly riling they don't need to not only you have to worry about like making sure the users have the correct permissions over their own systems they also need to worry about bones will know bilities on those systems as well they could allow a non privileged user to escalate those privileges and that's kind of what we're going to talk about today so you know the question sometimes you Admin Attacks get is like so what if users are admins well like what could you actually do with that well leads to many other attack vectors for one you could extract the local password hashes from a system and then potentially use those against other systems you know a lot of times we'll find that the local admin password isn't being randomized across multiple systems so it's very easy to just take a pass crash and perform a pass the hash tag hop consistent system I simply just having admin access to one system additionally you could do network level types of attacks so for example if you have admin access to system you can start up SMB servers and then perform like poisoning type of attacks like like ello women are in DNS poisoning you can also you know you can do packet capture on the low post like so you might be miss something across the wire there you can I mean obviously users your admin they can install software and then you know additionally it's your Navin you can typically extract codex creds from memory provided it's not you know the latest version of Windows because you know they've actually done some nice mitigating efforts against that but you know so like yeah it's bad for just a typical user to have admin access to a system so what are some common privilege Common privilege escalation techniques escalation techniques that that I use and I think you know a lot of other people will end up using too so one thing that I always look for first when I get access to one is box is just check for missing patches on the system because you know there's plenty of exploits and vulnerabilities out there for Microsoft itself for privilege escalation vectors on systems so you know you can run this wmic command to find the latest hot fixes that were installed the latest patches they were installed on system then you could compare that to a list of potential patches that have exploits available for them in terms of privilege escalation so what you could do is search exploit eb from Kali with the tool called search void search floyd is really awesome and the fact you can give it a number of different search terms and search for specific exploits regarding what you want so like if you wanted to search for like in ms 16 like a kb article for windows in a local privilege escalation type of vulnerability you could do search floyd in that sixteen windows local so i mean if you you know if you knew that this hasn't patch them you now ten years you could search you know MSO eight or whatever very much you know oh seven in you know find a number of different potential exploits for the the patches that are missing from that system another thing that i always like to do in terms of like finding additional access not necessarily privilege escalation but it could lead to privilege escalation is finding credentials from a user for other sites and one of the best ways to do that is like so you've got access to a user's account on a system you can usually extract their credentials from the browser history or from the browser so a lot of times you know people like you know click the to say store credentials for example in chrome or IE and those credentials can be extracted fairly easily there's a few Metasploit modules to go and extract them and in addition to not not only just the credentials but cookies can be extracted as well and you know potentially like if they had a log into a site let's say that you know there's some sort of admin of I don't know like a some portal or something you might be able to like log into the sim and find you know an additional vector there somehow another tool that just came out pretty recently from fireEye is this tool called session gopher that will find stored credentials for putty one at CP and RDP you know potentially you know giving you additional access to another system which might be useful another really awesome privilege escalation technique came out recently was hot potato right at the end of 2016 there this one was released and this it's from foxglove ii basically a vulnerability in which it's possible to fake aw pad proxy on a system do it in dns spoofing and then have basically like you perform like a like a Windows Defender update and it will basically man the middle that that connection out and allow you to utilize like that system level privilege that the Windows Defender update is using against the own system to run something so you could tell it to run a command you wanted to run like let's say Adam a user or something and then add a new Batman so very cool there and the last thing and I think this is probably the most important thing that I've seen in terms of privilege escalation in the last few years is power up from harm enjoy it's an amazing powerful tool that will check a number of different things including you know finding hi jackal DLL that applying on a tenet install files you know various modifiable services and in addition to that it also provides various tools for for actually exploit those so not only will tell you like here's a vulnerability here's here's something that you might be able to actually here's a tool to actually go right like the binary right the DLL you can use to hijack that process so that's the tool I wanted to demos today because it's Demo pretty fun so let's go over to our power up demo okay so we've got a one to seven bucks here we've got a current user as M veers and we'll go ahead and net local group administrators to show that our inverse user is not in the local admins group he's also he's not a domain admin so you know we shouldn't be able to really run anything as an admin currently so let's go ahead and run powerup to see if there's any privilege escalation vectors that he might be able to exploit so let's go ahead and run PowerShell that XD that's exec type apps and we're going to import the module powerup so you know with powerup there's like I said there's a few different specific modules for the various different vulnerabilities that you might want to run or if you want to run all of them you can run them VOC - all checks and I will check all the privileged Oh special abilities of power it knows about taken seat right here it tries to first just say hey as this guy in a local admin group checks for various included service paths the checks for service executable an argument for missions checks for service permissions you know checks for a lot of different things that commonly might lead to privilege escalation and a lot of times we found a number of these different things are in fact vulnerable on on systems that we're testing it's one instance one specific thing that I have found kind of often is always install elevated in the registry so I decided to kind of dim it down here because I have seen it a few times on various assessments so this one is kind of a really terrible vulnerability because what that essentially means is if always install elevated is enabled in the registry that essentially means that any user regardless of whether or not they're an admin or not can run any executable as an admin that's really bad because all user has to do is create a binary that adds a new local admin or does something that they want to do maliciously run it just normal I can or --ml user would run a program and it will automatically run that program as an ADD so like I mentioned earlier you know harms really added in like the various functions to actually perform these these various exploits against these vulnerabilities which i think is very awesome so for example the right - user add-in that sighs what we're going to do - to write out and in the SCI file that will create a sin you local admin so write user add an aside so you know after we've already important powerup which run right - user add that aside it will generate this new user at MSI right here on the desktop and let's let that finish shop and then once that's done if when we run it it will allow us to either here we go so when we run it allow us to add a you know a new user we can name it whatever we want you have to go to password I like on this current system I accept and modify as a default password because it doesn't meet the password complexity requirements for the system you know it doesn't need that actually the password you put your does have to actually like be a valid password for the system or won't work so you give it a you know use maybe one give it the password you want and the group we want is admin traitor so let's go and create and now let's go check local group of administrators and we have our new backdoor user right there so if we want to we can now go run a command as the backdoor user in and that would be our administrative user in the system so essentially we've escalated privileges using power up pretty neat huh so all right that is it for this edition of tradecraft security weekly you know one thing that you know you probably Outro want to go do this for the blue team anyway is you know for each of your standard Windows images like prior to you pushing them out or you know reinstalling on on new systems you know run things like power up against them and check them for privilege escalation vulnerabilities that way you're not just pushing out you know vulnerable software into your environment and you know allowing any normal user to escalate privileges I've also got you know a couple more privilege escalation tradecraft scary weeklies coming up in the near future so it's a tune for those 181 for Linux and also one for Network level vulnerabilities which will be a lot of fun so follow me on Twitter a month I'm Adaptec on Twitter thanks so much for watching have a great day  
