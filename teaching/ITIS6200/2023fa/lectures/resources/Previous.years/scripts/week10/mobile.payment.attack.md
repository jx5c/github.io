who has show me the money who would not love that finding flawed implementations of third-party in-app payments in Android applications and once you ready please take the way okay I'm yo I'm young boy from shanghai jiaotong university and the title of my paper is showed me the manor is fighting for all the implementations of third party at preventing android applications and we know that the mobile payment has developed such a magical age especially in China uses in recent years and the mobile payments in China it's the market is up to two trillion years dollar and which is the 20 times of the American and the mobile payments must only include the offline NFC play like a pro papers also the in-app payment and which means that people can the left and advising Turner pay for it seeing as soul however previous work meeting focused on the security of traditional web application payments and so far there are no unified specifications or a best approach to validate the security of payment so in all paperwork first described the in-app payment process and then we will give a series of security rules that which should be obeyed throughout the transaction and the severe consequence of violating these security road and the finally we will detect the flows being real app so you In-app Payment Demystified know typical in-app payment process there are four rows which is the merchant app and it always integrate the third party payment SDKs and also the merchant server kesha server and we choose China which is the world largest in air payments or market in the world to be our research target and we also choose for popular catchers in China which is alipay which are paid and the Union pay and bye-bye to pay and all of them claim that they have over 100 million registered users so to illustrate how popular being a payment in China and we also download 7000 s from the Android app market in China and we use static analysis to these samples and we found that okay or all of these apps are the most popular as which have more than 100,000 downloads and we use static analysis to these apps and we found that over one-third often uses at least one of the four third-party payment SDK in the ass and so we concluded to process models In-app Payment Process Model from the for caches in a payment process which are two ended the Union peruse the first model and the the addy Pender by to pay use the second one so I was described the first in detail when users want to buy something the merchant app will send the merchant order request to the virtual server and again the merchants over well of generation decide the payment order according to the merchant order and ascended to the catcher server after death the treasure server will return a message contains the transaction number to the merchant server and the emergence over at his signature are yet to enter return back to the merchant app then the merchant app invoked the TPS you getting it and then the TPS today we're all are prompt our windows that show the users that your information about these payments and ask for the users confirm nation of after user approved to pay and stand up a request to the cashiers over at the catcher's so we'll use the money in the user's account and everything's ok he will the cashiers will send the payment or the notification to the merchant server as well the hippest gate and the TPS secured held called the merchant app to show the window to the user that you're paid your payment is complete and the end after meanwhile the merchant server she makes an extra worried about the payment order to the caching server to confirm every details of the payment and again after that the merchant should deliver the merchandise to the users so the figure the model is quite different the mailing occurs in the step to the merchant server generation side the permit payment order and attended the back to the merchant ask and at the end of merchant and the end of information about the payments auto will stand in the depth for to the cashiers so yes this is different so we then further conductor or security and narrative through this process model and before that we give our anniversary model we assume that they are check the attackers can reverse engineering the merchant a vendor the invaded gps DK and that the attacker can also fold your quest or message to both merchant server and catcher server also f the attack targets catcher or the merchants he can at the theater / just like he can use his own phone and he can control the data under the app and the system he can modify them but when the target when the attack targets other users then the attacker can only control the network communication between other users merchant app and his server if there is insecure network communication so this is the seventh security rule and Security Rules we concluded first the payment order must be generated and signed by the merchant server and the signing key should never exposed to others and they are also true for the GPS DK is should inform use a detailed information of these payments order and verified chance the owner of the transaction which means that the payment order belongs to the last two which of the merchant app and also always use secure network communication between the client and the server and they also to be could erode for the merchant server and he assured the verify the signature of the received message and he should also make an extra query to the notified and payment from the cash reserve so if one or more security rules are violated energiya the in-app payment probe protest will suffer the wrath of attack and we concluded for attack four types of attacks into the first year the order tampering attack and we can see from the front picture ft merchant in correctly implemented hit a payment order generation or signing the merchant app the NT attack can temporary the content for example the total amount of the money in the payment order and tended to Turkish a server so this attack can be successful also require that the merchant server failed to make an extra query to the about the payment to the pleasure server otherwise he will founded he will find that the money is different from the original one because he can the merchant declare recuerda origin a price from the merchant order in the step one so the second attack is notification forging attack which means that the attacker want to buy something but without painting it instead he send a fake payments or the notification to the merchant server if the if the server accepted the notification which means that he failed to verify the message signature or the attacker make use of the the kinky to give it with a valid signature then the merchant several exceptions also he requests the merchant failed to reconfirm the payment to the casual server otherwise he will fight that the phaedrus of these payments order is due and paid so the second or the third attack is order substituting attack which targets users other than our rather than the merchants compared with the to attack above and we can see from the picture and the attack intercepted the payment order returned from the and he made another payment made another order and he used his the attackers payment order and ascended to the merchant f of the victim users so it requests that the merchant using secure network between the merchant server and the merchant app also when the GPS decayed prompt window to ask for the users confirmation if the TP SDK showed incomplete information about the payment order the end user may click and confirm these payments without an education so this attack can be successful and the attacker can mislead our victim users to pay for the attackers order also the the Unauthorized Querying Attack fourth attack is unauthorized the Curia test and the attacker can use the leaking key to make courage to the catcher and he can acquire some see something security business information because he can occur every section recorded in the treasure and including the for example on the history hbu of the merchant and for every day or every details of the transaction so with the Detecting Flawed In-app Payment entity is floating of these of in-app payments the first T is the local order in which means that the merchant generation aside the payment order in app so we just searched you are a definite destination URL of glazing payments orders the merchant average only appear in the merchant server so for example this is for the recharge plate and then we detect the key leakage and we use some specific features of the signing key and also there are some other techniques to accurately detect and the sign impede the detail is describing my paper so also we try to check the incomplete prompt we checked every the fall cassius the TPS decayed whether in the in the window there are payment order ID or the person dies or the user or the user of this payment order and the person's name and the amount total amongst many of these payment order also we checked the weather GPS pika accept payment order which does not belong to the host merchant app and the insecure network communication with that proxy to perform in the middle attack between the client and the server also we check whether the flaws in the merchant server which app whether the server access the temp temper the payment order with the valid signature which indicates that they did not made confirmation of the notified payment and also we Forge our notifications to the merchants over with Ingrid signature to check whether they missed a signature validation so this is Empirical Study the result and we can see that hundreds of apps leak they are key in the app and over 100f which used which I'd pay which I'll pay a commenter local ordering mistakes and this is the floating the TPS decays and only recharge play corrective verify the transaction and none often shows complete information and all of them use secure a secure network communication but there are unsecured communications in the merchant app and over half of them are vulnerable also we considerable proxying of merchant server the first flows so we want to know why so many Root cause Inquiry merchants make these mistakes so we check the sample code and official documents from released by the catcher and a week found that the sample code also commit these evaluative security rules and update themselves so for the motions followed this simple code will suffer the areas of attack and also there are conflicts between the code and document which may confuse the developer of the merchant also the back of the temple for the implementation of the server may explain the server mistakes so also there are the cutting complete function may due to the compromise of order business also the merchant polymer modified signing key to the weepies and which may suffer brute force attacks and Ethical Consideration we also have several case studies in our paper and we reported audit findings to the little parties and treasures fix the mistakes in the sample code and the document and also we report all the vulnerable apps listed to the cheshire Security Response Center which is responsible for dia payment ecosystem so also we return and replace items in our ticket so let's all thank you as the Prince of speaker you have questions please step up to the microphone again please state your name and affiliation  
